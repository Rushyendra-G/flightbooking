{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Flight Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Flight Search</h2>
        
        <!-- Journey Type Selection -->
        <div class="btn-group mb-4" role="group">
            <a href="?type=1" class="btn btn-{% if journey_type == '1' %}primary{% else %}outline-primary{% endif %}">
                One Way
            </a>
            <a href="?type=2" class="btn btn-{% if journey_type == '2' %}primary{% else %}outline-primary{% endif %}">
                Round Trip
            </a>
            <a href="?type=3" class="btn btn-{% if journey_type == '3' %}primary{% else %}outline-primary{% endif %}">
                Multi City
            </a>
        </div>

        <form method="post" id="flightSearchForm">
            {% csrf_token %}
            <input type="hidden" name="journey_type" value="{{ journey_type }}">
            
            <!-- Passenger Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Passenger Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label>Adults</label>
                            {{ form.adult_count }}
                        </div>
                        <div class="col-md-4">
                            <label>Children</label>
                            {{ form.child_count }}
                        </div>
                        <div class="col-md-4">
                            <label>Infants</label>
                            {{ form.infant_count }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flight Details -->
            {% if journey_type == '1' or journey_type == '2' %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Flight Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label>From</label>
                                {{ form.origin }}
                            </div>
                            <div class="col-md-6">
                                <label>To</label>
                                {{ form.destination }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label>Departure Date</label>
                                {{ form.departure_date }}
                            </div>
                            <div class="col-md-4">
                                <label>Departure Time</label>
                                {{ form.departure_time }}
                            </div>
                            <div class="col-md-4">
                                <label>Cabin Class</label>
                                {{ form.flight_cabin_class }}
                            </div>
                        </div>
                        {% if journey_type == '2' %}
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Return Date</label>
                                    {{ form.return_date }}
                                </div>
                                <div class="col-md-6">
                                    <label>Return Time</label>
                                    {{ form.return_time }}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <!-- Multi-city segments -->
                {% for segment_form in form.segment_forms %}
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Flight {{ forloop.counter }}</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label>From</label>
                                    {{ segment_form.origin }}
                                </div>
                                <div class="col-md-6">
                                    <label>To</label>
                                    {{ segment_form.destination }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Date</label>
                                    {{ segment_form.departure_date }}
                                </div>
                                <div class="col-md-4">
                                    <label>Time</label>
                                    {{ segment_form.departure_time }}
                                </div>
                                <div class="col-md-4">
                                    <label>Cabin Class</label>
                                    {{ segment_form.flight_cabin_class }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if journey_type == '3' %}
                    <input type="hidden" name="segment_count" value="{{ form.segment_forms|length }}">
                    <button type="button" class="btn btn-outline-primary mb-4" id="addSegment">
                        Add Another Flight
                    </button>
                {% endif %}
            {% endif %}

            <!-- Additional Options -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Additional Options</h5>
                </div>
                <div class="card-body">
                    <div class="form-check">
                        {{ form.direct_flight }}
                        <label class="form-check-label">Direct Flights Only</label>
                    </div>
                    <div class="form-check">
                        {{ form.one_stop_flight }}
                        <label class="form-check-label">One Stop Flights Only</label>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Search Flights</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            let segmentCount = {{ form.segment_forms|length|default:2 }};
            
            $('#addSegment').click(function() {
                const newSegmentHtml = `
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Flight ${segmentCount + 1}</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label>From</label>
                                    <input type="text" name="segment_${segmentCount}-origin" class="form-control" maxlength="3" placeholder="From (e.g. BOM)" required>
                                </div>
                                <div class="col-md-6">
                                    <label>To</label>
                                    <input type="text" name="segment_${segmentCount}-destination" class="form-control" maxlength="3" placeholder="To (e.g. DEL)" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label>Date</label>
                                    <input type="date" name="segment_${segmentCount}-departure_date" class="form-control" required>
                                </div>
                                <div class="col-md-4">
                                    <label>Time</label>
                                    <select name="segment_${segmentCount}-departure_time" class="form-control" required>
                                        {% for value, label in form.segment_forms.0.departure_time.field.choices %}
                                            <option value="{{ value }}">{{ label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label>Cabin Class</label>
                                    <select name="segment_${segmentCount}-flight_cabin_class" class="form-control" required>
                                        {% for value, label in form.segment_forms.0.flight_cabin_class.field.choices %}
                                            <option value="{{ value }}">{{ label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>`;

                $(newSegmentHtml).insertBefore(this);
                segmentCount++;
                $('input[name="segment_count"]').val(segmentCount);
            });
        });
    </script>
</body>
</html>