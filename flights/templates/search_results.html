{% extends "search_form.html" %}

{% block content %}
<div id="searchResults" class="mt-5">
    <h2>Search Results</h2>
    <div id="flightList"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('flightSearchForm');
    const resultsContainer = document.getElementById('flightList');
    const searchUrl = "{% url 'search_flights' %}";
    const csrfToken = "{{ csrf_token }}";

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);

        fetch(searchUrl, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': csrfToken
            }
        })
        .then(response => response.json())
        .then(data => {
            resultsContainer.innerHTML = '';
            if (data.Response && data.Response.Results && data.Response.Results.length > 0) {
                data.Response.Results[0].forEach(flight => {
                    const flightCard = document.createElement('div');
                    flightCard.className = 'card mb-3';
                    flightCard.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${flight.AirlineCode} ${flight.FlightNumber}</h5>
                            <p class="card-text">
                                Departure: ${flight.Origin.Airport.AirportCode} at ${flight.Origin.DepTime}<br>
                                Arrival: ${flight.Destination.Airport.AirportCode} at ${flight.Destination.ArrTime}<br>
                                Duration: ${flight.Duration}<br>
                                Price: ${flight.Fare.PublishedFare}
                            </p>
                            <button class="btn btn-primary">Book</button>
                        </div>
                    `;
                    resultsContainer.appendChild(flightCard);
                });
            } else {
                resultsContainer.innerHTML = '<p>No flights found</p>';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            resultsContainer.innerHTML = '<p>An error occurred while searching for flights</p>';
        });
    });
});
</script>
{% endblock %}